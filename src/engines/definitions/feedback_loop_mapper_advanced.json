{
  "engine_key": "feedback_loop_mapper_advanced",
  "engine_name": "Feedback Loop Mapper (Advanced)",
  "description": "Deep analysis of how systems behave over time. Reveals the hidden feedback loops that drive growth and decline, the counterintuitive dynamics that make well-intentioned interventions backfire, and the leverage points where small changes can produce big effects. Uses sophisticated methods from Meadows, Senge, and system dynamics but outputs in plain language anyone can understand.",
  "version": 1,
  "category": "systems",
  "kind": "synthesis",
  "reasoning_domain": "systems_thinking_advanced",
  "researcher_question": "What feedback loops drive this system's behavior, and where are the leverage points?",
  "canonical_schema": {
    "system_boundary": {
      "system_id": "string (format: 'SYS{N}')",
      "system_name": "string",
      "what_is_included": ["string"],
      "what_is_excluded": ["string"],
      "time_horizon": "string (how far into the future)",
      "key_purpose": "string (what the system is for)",
      "boundary_judgments": ["string (why boundary drawn here)"],
      "source_articles": ["string"]
    },
    "stocks": [
      {
        "stock_id": "string (format: 'STK{N}')",
        "name": "string (evocative name)",
        "what_it_is": "string (the accumulation)",
        "stock_type": "physical | informational | financial | human | social | natural | abstract",
        "units": "string (what it's measured in)",
        "current_level": "string (high, medium, low, or specific)",
        "capacity_limits": {
          "upper_limit": "string | null",
          "lower_limit": "string | null",
          "what_happens_at_limits": "string | null"
        },
        "source_articles": ["string"],
        "inflows": ["flow_id (FLW{N})"],
        "outflows": ["flow_id (FLW{N})"],
        "affects_loops": ["loop_id (R{N} or B{N})"]
      }
    ],
    "flows": [
      {
        "flow_id": "string (format: 'FLW{N}')",
        "name": "string",
        "what_it_is": "string (the rate of change)",
        "flow_type": "inflow | outflow",
        "target_stock": "stock_id (STK{N})",
        "rate_determining_factors": ["string (what affects the rate)"],
        "current_rate": "string (high, medium, low)",
        "controllability": "controllable | partially_controllable | uncontrollable",
        "who_controls": "string | null",
        "source_articles": ["string"],
        "regulated_by": ["valve_id (VLV{N})"]
      }
    ],
    "feedback_loops": [
      {
        "loop_id": "string (format: 'R{N}' for reinforcing, 'B{N}' for balancing)",
        "name": "string (evocative name like 'The Poverty Trap' or 'The Thermostat')",
        "loop_type": "reinforcing | balancing",
        "story": "string (the narrative of what happens)",
        "variables_in_loop": [
          {
            "variable_id": "string (stock_id or auxiliary)",
            "variable_name": "string",
            "role_in_loop": "string"
          }
        ],
        "causal_chain": [
          {
            "from_variable": "string",
            "to_variable": "string",
            "polarity": "+ | -",
            "mechanism": "string (how one affects the other)",
            "time_delay": "none | short | medium | long",
            "delay_duration": "string | null"
          }
        ],
        "loop_length": "number (how many steps)",
        "current_state": "dormant | weak | active | dominant",
        "strength": "number (0-1)",
        "goal_if_balancing": "string | null (what it tries to maintain)",
        "growth_behavior_if_reinforcing": "exponential_growth | exponential_decline | collapse | explosion",
        "historical_behavior": "string (what it has done)",
        "source_articles": ["string"],
        "interacts_with_loops": ["loop_interaction_id (LI{N})"],
        "involves_stocks": ["stock_id (STK{N})"],
        "involves_delays": ["delay_id (DEL{N})"]
      }
    ],
    "loop_interactions": [
      {
        "interaction_id": "string (format: 'LI{N}')",
        "name": "string",
        "loops_involved": ["loop_id (R{N} or B{N})"],
        "interaction_type": "dominance_shift | reinforcement | cancellation | sequencing | oscillation",
        "what_happens": "string",
        "conditions_for_interaction": "string",
        "which_dominates_when": "string",
        "source_articles": ["string"],
        "produces_behavior": "behavior_id (BEHV{N})"
      }
    ],
    "time_delays": [
      {
        "delay_id": "string (format: 'DEL{N}')",
        "name": "string",
        "location": "string (where in the system)",
        "delay_type": "information | material | perception | decision | action",
        "duration": "string (how long)",
        "variability": "fixed | variable | uncertain",
        "consequences": {
          "overshoot_risk": "string",
          "oscillation_risk": "string",
          "policy_resistance": "string"
        },
        "source_articles": ["string"],
        "in_loop": "loop_id (R{N} or B{N})",
        "affects_behavior": ["behavior_id (BEHV{N})"]
      }
    ],
    "system_archetypes": [
      {
        "archetype_id": "string (format: 'ARCH{N}')",
        "archetype_name": "string (e.g., 'Limits to Growth', 'Shifting the Burden', 'Tragedy of the Commons')",
        "archetype_type": "limits_to_growth | shifting_burden | eroding_goals | escalation | success_to_successful | tragedy_of_commons | fixes_that_fail | growth_and_underinvestment | accidental_adversaries",
        "description": "string (the generic pattern)",
        "loops_involved": ["loop_id (R{N} or B{N})"],
        "characteristic_behavior": "string",
        "warning_signs": ["string"],
        "leverage_points": ["string (where to intervene)"],
        "pitfalls": ["string (what not to do)"],
        "source_articles": ["string"],
        "instances_in_system": ["string (specific manifestations)"]
      }
    ],
    "leverage_points": [
      {
        "leverage_id": "string (format: 'LEV{N}')",
        "name": "string",
        "leverage_type": "parameters | buffers | stock_flow_structures | delays | balancing_loops | reinforcing_loops | information_flows | rules | self_organization | goals | paradigms | transcending_paradigms",
        "meadows_level": "number (1-12, 12 is most powerful)",
        "location_in_system": "string",
        "what_to_change": "string",
        "expected_effect": "string",
        "why_high_leverage": "string",
        "implementation_difficulty": "easy | moderate | difficult | very_difficult",
        "resistance_expected": ["string (who/what will resist)"],
        "unintended_consequences": ["string (possible backfires)"],
        "source_articles": ["string"],
        "affects_loops": ["loop_id (R{N} or B{N})"],
        "affects_stocks": ["stock_id (STK{N})"]
      }
    ],
    "system_behaviors": [
      {
        "behavior_id": "string (format: 'BEHV{N}')",
        "name": "string",
        "behavior_type": "exponential_growth | exponential_decline | goal_seeking | oscillation | s_shaped_growth | overshoot_and_collapse | overshoot_and_oscillation | equilibrium | chaos",
        "description": "string",
        "time_pattern": "string (what happens over time)",
        "driving_loops": ["loop_id (R{N} or B{N})"],
        "driving_delays": ["delay_id (DEL{N})"],
        "archetype_if_any": "archetype_id (ARCH{N}) | null",
        "stability": "stable | unstable | conditionally_stable",
        "reversibility": "reversible | irreversible | hysteresis",
        "source_articles": ["string"]
      }
    ],
    "tipping_points": [
      {
        "tipping_id": "string (format: 'TIP{N}')",
        "name": "string",
        "what_tips": "string (what changes dramatically)",
        "threshold": "string (what level triggers the tip)",
        "before_state": "string",
        "after_state": "string",
        "reversibility": "reversible | irreversible | partially_reversible",
        "early_warning_signs": ["string"],
        "time_to_tip": "string (how fast once triggered)",
        "source_articles": ["string"],
        "involves_loops": ["loop_id (R{N} or B{N})"],
        "involves_stocks": ["stock_id (STK{N})"]
      }
    ],
    "counterintuitive_dynamics": [
      {
        "counterintuitive_id": "string (format: 'CI{N}')",
        "name": "string",
        "intuitive_expectation": "string (what common sense suggests)",
        "actual_behavior": "string (what really happens)",
        "why_counterintuitive": "string (the mechanism that creates surprise)",
        "policy_implication": "string (what this means for intervention)",
        "source_articles": ["string"],
        "involves_loops": ["loop_id (R{N} or B{N})"],
        "involves_delays": ["delay_id (DEL{N})"],
        "involves_archetype": "archetype_id (ARCH{N}) | null"
      }
    ],
    "mental_models": [
      {
        "model_id": "string (format: 'MM{N}')",
        "name": "string",
        "held_by": ["string (who holds this mental model)"],
        "model_content": "string (what they think the system is)",
        "matches_reality": "number (0-1, how accurate)",
        "what_it_misses": ["string (important dynamics not captured)"],
        "policy_implications": "string (what policies this model suggests)",
        "why_persistent": "string (why this model persists despite inaccuracy)",
        "source_articles": ["string"]
      }
    ],
    "intervention_analysis": [
      {
        "intervention_id": "string (format: 'INT{N}')",
        "name": "string",
        "what_is_changed": "string",
        "intended_effect": "string",
        "actual_effect": "string",
        "time_horizon_of_effect": "immediate | short_term | medium_term | long_term",
        "side_effects": ["string"],
        "why_backfired": "string | null (if it backfired)",
        "loops_activated": ["loop_id (R{N} or B{N})"],
        "loops_deactivated": ["loop_id (R{N} or B{N})"],
        "resistance_encountered": ["string"],
        "source_articles": ["string"]
      }
    ],
    "cross_document_dynamics": {
      "shared_loops": [
        {
          "loop_id": "loop_id (R{N} or B{N})",
          "recognized_by": ["string (articles)"]
        }
      ],
      "contested_loop_interpretations": [
        {
          "loop": "string (what loop/dynamic)",
          "interpretation_a": "string",
          "interpretation_b": "string",
          "articles_supporting_a": ["string"],
          "articles_supporting_b": ["string"]
        }
      ],
      "shared_archetypes": ["archetype_id (ARCH{N})"],
      "leverage_point_debates": [
        {
          "issue": "string",
          "proposed_leverage_points": ["leverage_id (LEV{N})"],
          "disagreements": "string"
        }
      ]
    },
    "relationship_graph": {
      "nodes": [
        {
          "id": "string",
          "type": "stock | flow | loop | delay | archetype | leverage | behavior | tipping_point | intervention",
          "label": "string",
          "weight": "number (0-1)",
          "polarity": "+ | - | null"
        }
      ],
      "edges": [
        {
          "from_id": "string",
          "to_id": "string",
          "relationship": "flows_to | affects | part_of | interacts_with | delays | drives | triggers | implements",
          "polarity": "+ | -",
          "strength": "number (0-1)",
          "delay": "none | short | medium | long",
          "label": "string | null"
        }
      ],
      "clusters": [
        {
          "cluster_id": "string",
          "name": "string",
          "member_ids": ["string"],
          "cluster_type": "subsystem | archetype_instance | intervention_domain",
          "theme": "string"
        }
      ]
    },
    "causal_loop_diagram": {
      "diagram_id": "string",
      "name": "string",
      "variables": [
        {
          "var_id": "string",
          "name": "string",
          "type": "stock | auxiliary | parameter"
        }
      ],
      "connections": [
        {
          "from": "string",
          "to": "string",
          "polarity": "+ | -",
          "delay": "boolean"
        }
      ],
      "loops_marked": ["loop_id (R{N} or B{N})"]
    },
    "meta": {
      "total_stocks": "number",
      "total_flows": "number",
      "total_reinforcing_loops": "number",
      "total_balancing_loops": "number",
      "total_delays": "number",
      "total_leverage_points": "number",
      "total_archetypes": "number",
      "dominant_loops": ["loop_id"],
      "dominant_archetype": "archetype_id | null",
      "highest_leverage_point": "leverage_id",
      "most_dangerous_tipping_point": "tipping_id | null",
      "overall_stability": "stable | unstable | conditionally_stable",
      "system_trajectory": "growing | declining | oscillating | equilibrium | chaotic",
      "document_count": "number",
      "total_relationships": "number",
      "graph_density": "number (0-1)"
    }
  },
  "extraction_focus": [
    "feedback_loops",
    "stocks_and_flows",
    "time_delays",
    "system_archetypes",
    "leverage_points",
    "tipping_points",
    "counterintuitive_dynamics",
    "intervention_analysis"
  ],
  "primary_output_modes": [
    "gemini_network_graph",
    "integrated_report",
    "structured_text_report",
    "smart_table",
    "mermaid_flowchart"
  ],
  "paradigm_keys": [],
  "source_file": "analyzer/src/engines/feedback_loop_mapper_advanced.py",
  "stage_context": {
    "framework_key": "meadows",
    "additional_frameworks": ["senge", "sterman", "forrester"],
    "extraction": {
      "analysis_type": "feedback loop",
      "analysis_type_plural": "feedback loops",
      "core_question": "What feedback loops drive this system's behavior, and where are the leverage points?",
      "extraction_steps": [
        "DEFINE SYSTEM BOUNDARY: What's included? Excluded? Why? What's the time horizon?",
        "IDENTIFY STOCKS: What accumulates in this system? What are the key state variables? What are their limits?",
        "IDENTIFY FLOWS: What changes the stocks? What flows in and out? Who controls the flows?",
        "TRACE FEEDBACK LOOPS: Follow the causal chains. Does A affect B affect C affect A? If the loop amplifies (same signs), it's reinforcing (R). If it stabilizes (odd number of negative signs), it's balancing (B)",
        "NAME THE LOOPS: Give each loop an evocative name that captures its story ('The Success Trap', 'The Thermostat Effect')",
        "IDENTIFY TIME DELAYS: Where are there lags between cause and effect? How long? What are the consequences?",
        "MAP LOOP INTERACTIONS: How do loops interact? Which dominates when? What shifts dominance?",
        "IDENTIFY SYSTEM ARCHETYPES (Senge): Does this match a known pattern - Limits to Growth, Shifting the Burden, Escalation, etc.?",
        "FIND LEVERAGE POINTS (Meadows): Where can small changes produce large effects? Use Meadows' 12 leverage points hierarchy",
        "IDENTIFY TIPPING POINTS: Where might the system tip into a different behavior mode? What are the early warnings?",
        "FIND COUNTERINTUITIVE DYNAMICS: Where does the system behave opposite to intuition? Why?",
        "ANALYZE INTERVENTIONS: What has been tried? What worked? What backfired? Why?",
        "MAP MENTAL MODELS: What mental models do actors hold? How do they differ from reality?",
        "BUILD THE RELATIONSHIP GRAPH: Connect stocks, flows, loops, delays, interventions"
      ],
      "key_fields": {
        "loop_id": "Individual feedback loops (R for reinforcing, B for balancing)",
        "stock_id": "Accumulations in the system",
        "leverage_id": "Where intervention can be effective",
        "archetype_id": "Known system patterns"
      },
      "id_field": "loop_id",
      "key_relationships": [
        "flows_to",
        "affects",
        "part_of",
        "interacts_with",
        "delays",
        "drives",
        "triggers",
        "implements"
      ],
      "special_instructions": "CRITICAL: The key insight is usually about feedback - how actions feed back to change conditions for future actions. Don't just list causes and effects - find the loops. And remember: in complex systems, cause and effect are often distant in time and space. The most powerful leverage points are often paradigms and goals, not parameters."
    },
    "curation": {
      "item_type": "feedback loop",
      "item_type_plural": "feedback loops",
      "consolidation_rules": [
        "IDENTIFY SHARED LOOPS: What loops are recognized across documents?",
        "RESOLVE CONTESTED INTERPRETATIONS: Where do documents disagree about loop structure?",
        "BUILD MASTER CAUSAL DIAGRAM: Integrate all loops into coherent whole",
        "IDENTIFY SHARED ARCHETYPES: What patterns recur?",
        "MAP LEVERAGE POINT DEBATES: Where do documents disagree about where to intervene?",
        "Never mention Meadows, Senge, system dynamics - lead with concrete system insights"
      ],
      "cross_doc_patterns": [
        "shared_loops",
        "contested_interpretations",
        "shared_archetypes",
        "leverage_point_debates"
      ],
      "synthesis_outputs": [
        "consolidated_loop_map",
        "relationship_graph",
        "cross_document_dynamics",
        "causal_loop_diagram"
      ],
      "special_instructions": "The most valuable finding is often the counterintuitive dynamic - where the system does the opposite of what common sense suggests. Also valuable: finding the leverage point nobody has noticed."
    },
    "concretization": {
      "id_examples": [
        {"from": "R1", "to": "The Success-Breeds-Success Reinforcing Loop"},
        {"from": "B1", "to": "The Market Saturation Balancing Loop"},
        {"from": "STK1", "to": "Customer Base (stock)"},
        {"from": "DEL1", "to": "6-month Delay in Market Response"},
        {"from": "ARCH1", "to": "Limits to Growth in Market Expansion"},
        {"from": "LEV1", "to": "Leverage: Changing the Business Model (Level 4)"},
        {"from": "TIP1", "to": "Market Share Tipping Point at 30%"},
        {"from": "CI1", "to": "Counterintuitive: Marketing Push Slows Growth"}
      ],
      "naming_guidance": "Use evocative names that tell the loop's story. Include polarity indicators (+/-). Be concrete.",
      "recommended_table_types": ["loop_inventory", "leverage_ranking", "archetype_matrix"],
      "recommended_visual_patterns": ["causal_loop_diagram", "stock_flow_diagram", "behavior_over_time"]
    },
    "audience_vocabulary": {
      "researcher": {
        "loop": "feedback loop",
        "stock": "stock variable",
        "archetype": "system archetype",
        "leverage": "leverage point"
      },
      "analyst": {
        "loop": "circular causation",
        "stock": "accumulation",
        "archetype": "system pattern",
        "leverage": "intervention point"
      },
      "executive": {
        "loop": "dynamic",
        "stock": "key metric",
        "archetype": "common pattern",
        "leverage": "strategic lever"
      },
      "activist": {
        "loop": "vicious/virtuous cycle",
        "stock": "what builds up",
        "archetype": "trap we're in",
        "leverage": "where to push"
      }
    },
    "skip_concretization": false
  }
}
